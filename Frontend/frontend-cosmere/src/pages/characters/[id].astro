---
import { fetchCharacters } from "@lib/utils/fetchCharacters";
import { fetchCharacterId } from "@lib/utils/fetchCharacterId";
import type { Character } from "@lib/utils/fetchCharacters";
import Header from "@components/Header.astro"
import SectionInf from "@components/SectionInf.astro"

// Fetch atributos personajes

export async function getStaticPaths() {

  let characters: Character[] = [];

  try {
    characters = await fetchCharacters();
    console.log(characters);
  } catch (error) {
    console.error("Error fetching characters:", error);
  }

  return characters.map((character: Character) => ({
    params: { 
      id: character.id_Character 
     },
  }));
}

const { id } = Astro.params; 

// Buscamos al character por su ID (TODO: Intentar optimizar para no hacer dos b√∫squedas)

let characterId: Character | null = null;

try {
    characterId = await fetchCharacterId(id);
    console.log("CharacterID Encontrado! = " + characterId ? characterId?.id_Character : null);
} catch (error) {
    console.error("Error fetching characters:", error);
}

const nameCharacter = characterId ? characterId.name_Character : "Unknown Character";
const ageCharacter = characterId ? characterId.age_Character : 0; 
const sagaCharacter = characterId ? characterId.saga_inicial : "Unknown SagaCharacter Character"; 

---

<Header title={nameCharacter} description={sagaCharacter} />
<SectionInf /> 
